<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§§ 2026 é¦¬åˆ°æˆåŠŸï¼šå®¶æ—å°ˆå±¬ç´…åŒ… ğŸ§§</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { 
            --gold: #CDB38B; /* ç²¾ç·»é¦™æª³é‡‘ */
            --red: #9B1B30;  /* å…¸é›…é…’ç´… */
            --bright-red: #e62117;
        }
        body { font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; background: var(--red); color: #fff; margin: 0; display: flex; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
        .card { width: 90%; max-width: 350px; text-align: center; }
        
        .user-name { font-size: 20px; color: var(--gold); margin-bottom: 10px; font-weight: bold; }
        
        /* çé …é è¦½å€ */
        .prize-preview { background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 15px; margin-bottom: 30px; border: 1px solid rgba(205, 179, 139, 0.3); }
        .prize-preview div { font-size: 14px; margin-bottom: 8px; color: var(--gold); }
        .prize-preview span { display: inline-block; margin: 2px 8px; font-size: 13px; opacity: 0.9; }

        /* ç´…åŒ…è¢‹ */
        .envelope { width: 160px; height: 240px; background: var(--bright-red); border-radius: 15px; margin: 0 auto; position: relative; cursor: pointer; border: 4px solid var(--gold); box-shadow: 0 15px 35px rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; }
        .envelope::before { content: 'ç¦'; font-size: 60px; color: var(--gold); font-weight: bold; }
        
        /* æ–æ™ƒå‹•ç•« */
        .shake-slow { animation: shake 0.6s infinite; }
        @keyframes shake {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(5deg); }
            50% { transform: rotate(0eg); }
            75% { transform: rotate(-5deg); }
            100% { transform: rotate(0deg); }
        }

        /* é®ç½©èˆ‡å€’æ•¸ */
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 100; flex-direction: column; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        #status-text { font-size: 24px; color: #fff; margin-bottom: 30px; letter-spacing: 2px; }
        #countdown { font-size: 100px; color: var(--gold); font-weight: bold; }
        
        /* é–‹ççµæœ */
        #result-box { display: none; background: #fff; color: #333; padding: 40px 20px; border-radius: 25px; box-shadow: 0 20px 50px rgba(0,0,0,0.6); }
        .prize-name { font-size: 32px; color: var(--red); font-weight: bold; margin: 20px 0 10px 0; }
        .greeting-msg { font-size: 16px; color: #888; font-style: italic; margin-bottom: 25px; line-height: 1.5; }
        .btn-reset { background: var(--red); color: #fff; border: none; padding: 12px 40px; border-radius: 30px; cursor: pointer; font-size: 16px; font-weight: bold; }
    </style>
</head>
<body>

<div class="card">
    <div id="setup-view">
        <div id="user-display" class="user-name">æ­£åœ¨æº–å‚™å°ˆå±¬ç´…åŒ…...</div>
        <div class="prize-preview" id="prize-list-ui"></div>
        <div id="envelope-el" class="envelope shake-slow"></div>
        <p style="margin-top: 30px; font-weight: bold; color: var(--gold);">é»æ“Šç´…åŒ…é–‹å§‹æŒ‘æˆ°</p>
    </div>

    <div id="result-box">
        <div style="font-size: 18px; color: #666;">ğŸ§§ æ­å–œæŠ½ä¸­ ğŸ§§</div>
        <div id="prize-text" class="prize-name">---</div>
        <div id="greeting-text" class="greeting-msg"></div>
        <button class="btn-reset" onclick="location.reload()">å†ç©ä¸€æ¬¡</button>
    </div>
</div>

<div id="overlay">
    <div id="status-text">ä½¿å‹æ–æ™ƒæ‰‹æ©Ÿé–‹çï¼</div>
    <div id="countdown"></div>
</div>

<script>
    // --- åŸºç¤è¨­å®š ---
    const LIFF_ID = '2009142355-56pAevUd'; //å¡«ä½ çš„ LIFF ID
    
    // å°ˆå±¬çé …é—œéµå­— (æ¨¡ç³Šæ¯”å°)
    // åç¨±ä¸€å®šè¦è·Ÿæœ¬äººçš„ Line çš„åç¨±ä¸€æ¨£ï¼Œä¸ä¸€å®šè¦ä¸€æ¨¡ä¸€æ¨£ï¼Œä½†é—œéµå­—è¦å°
    const FAMILY_CONFIG = {
        'æœç¾è§€(æŸ¯å°¼å¡ç…§ç›¸é¤¨ï¼‰': ['æ—¥æœ¬æ±äº¬ä¾†å›æ©Ÿç¥¨ä¸€å¼µ âœˆï¸', 'ç¾é‡‘ 6600 å…ƒ ğŸ§§', 'ç¾é‡‘ 3600 å…ƒ ğŸ§§', 'é«˜ç´šä¸‹åˆèŒ¶é›™äººçµ„'],
        'ææ…¶æ´‹': ['æ—¥æœ¬æ±äº¬ä¾†å›æ©Ÿç¥¨ä¸€å¼µ âœˆï¸', 'ç¾é‡‘ 6600 å…ƒ ğŸ§§', 'ç¾é‡‘ 3600 å…ƒ ğŸ§§', 'é«˜ç´šå’Œç‰›ç‰›æ’æ™šé¤ä¸€å®¢ ğŸ¥©'],
        'default': ['ç¾é‡‘ 200 å…ƒ ğŸ§§', '200å…ƒ åˆ®åˆ®æ¨‚ 1å¼µ ', '100å…ƒ åˆ®åˆ®æ¨‚ 1å¼µ', '2026 å¥½é‹æ—ºæ—ºä¾† ğŸ®']
    };

    // é¦¬å¹´å°ˆå±¬å‰ç¥¥è©±
    const HORSE_GREETINGS = [
        "ç¥æ‚¨é¦¬åˆ°æˆåŠŸï¼Œäº‹äº‹é †å¿ƒï¼",
        "é¾é¦¬ç²¾ç¥ï¼Œèº«é«”å¥åº·è¬äº‹å¦‚æ„ï¼",
        "ä¸€é¦¬ç•¶å…ˆï¼Œé–‹æ˜¥å¤§å‰ç™¼å¤§è²¡ï¼",
        "é¦¬åŠ›åè¶³ï¼Œ2026 è²¡æºæ»¾æ»¾ä¾†ï¼",
        "è¬é¦¬å¥”é¨°ï¼Œå¥½é‹æ“‹éƒ½æ“‹ä¸ä½ï¼",
        "é‡‘é¦¬è¿æ˜¥ï¼Œè³æ«»ç¬‘è²é€£é€£ï¼",
        "å¤©é¦¬è¡Œç©ºï¼Œå‰µæ„ç„¡é™é¦¬å¹´å¤§ç™¼ï¼"
    ];

    let currentPrizes = [];
    let isGameStarted = false;

    // --- åˆå§‹åŒ– ---
    async function init() {
        try {
            await liff.init({ liffId: LIFF_ID });
            if (!liff.isLoggedIn()) {
                liff.login();
                return;
            }
            
            const profile = await liff.getProfile();
            const name = profile.displayName;
            document.getElementById('user-display').innerText = `çµ¦ ${name} çš„å°ˆå±¬ç´…åŒ…`;

            // æ¨¡ç³Šæ¯”å°é‚è¼¯
            let matchedKey = 'default';
            for (let key in FAMILY_CONFIG) {
                if (key !== 'default' && name.includes(key)) {
                    matchedKey = key;
                    break;
                }
            }
            currentPrizes = FAMILY_CONFIG[matchedKey];
            
            // æ›´æ–° UI é è¦½
            const listUI = document.getElementById('prize-list-ui');
            listUI.innerHTML = '<div>ä»Šæ—¥å¥½é‹çæ± ï¼š</div>' + 
                currentPrizes.map(p => `<span>â€¢ ${p}</span>`).join('');

        } catch (err) {
            document.getElementById('user-display').innerText = "è«‹ç”¨ LINE é–‹å•Ÿç´…åŒ…";
        }
    }

    // --- äº’å‹•é‚è¼¯ ---
    document.getElementById('envelope-el').addEventListener('click', async function() {
        if (isGameStarted) return;
        isGameStarted = true;

        if (typeof DeviceMotionEvent.requestPermission === 'function') {
            try {
                const permission = await DeviceMotionEvent.requestPermission();
                if (permission !== 'granted') {
                    startCountdown();
                    return;
                }
            } catch (e) {
                startCountdown();
                return;
            }
        }

        document.getElementById('overlay').style.display = 'flex';
        startShakeDetection();
    });

    function startShakeDetection() {
        let shakeCount = 0;
        const threshold = 15;

        function onMotion(e) {
            const acc = e.accelerationIncludingGravity;
            if (!acc) return;
            
            let movement = Math.abs(acc.x) + Math.abs(acc.y) + Math.abs(acc.z);
            if (movement > threshold) {
                shakeCount++;
                if (shakeCount > 12) {
                    window.removeEventListener('devicemotion', onMotion);
                    startCountdown();
                }
            }
        }
        window.addEventListener('devicemotion', onMotion);
    }

    function startCountdown() {
        document.getElementById('status-text').innerText = "æ°£é‹å‡èšä¸­...";
        let count = 3;
        const countEl = document.getElementById('countdown');
        countEl.innerText = count;

        const timer = setInterval(() => {
            count--;
            if (count > 0) {
                countEl.innerText = count;
            } else {
                clearInterval(timer);
                renderResult();
            }
        }, 1000);
    }

    function renderResult() {
        const luckyPrize = currentPrizes[Math.floor(Math.random() * currentPrizes.length)];
        const luckyGreeting = HORSE_GREETINGS[Math.floor(Math.random() * HORSE_GREETINGS.length)];
        
        confetti({
            particleCount: 200,
            spread: 80,
            origin: { y: 0.6 },
            colors: ['#CDB38B', '#FFD700', '#9B1B30']
        });

        document.getElementById('overlay').style.display = 'none';
        document.getElementById('setup-view').style.display = 'none';
        document.getElementById('result-box').style.display = 'block';
        document.getElementById('prize-text').innerText = luckyPrize;
        document.getElementById('greeting-text').innerText = luckyGreeting;
    }

    init();
</script>
</body>
</html>